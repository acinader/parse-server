{"version":3,"sources":["../../../src/Adapters/Auth/index.js"],"names":["facebook","require","facebookaccountkit","instagram","linkedin","meetup","google","github","twitter","spotify","digits","janrainengage","janraincapture","vkontakte","qq","wechat","weibo","anonymous","validateAuthData","Promise","resolve","validateAppId","providers","authDataValidator","adapter","appIds","options","authData","then","loadAuthAdapter","provider","authOptions","defaultAdapter","Object","assign","providerOptions","undefined","optionalAdapter","forEach","key","module","exports","enableAnonymousUsers","_enableAnonymousUsers","setEnableAnonymousUsers","enable","getValidatorForProvider","freeze"],"mappings":"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","file":"index.js","sourcesContent":["import loadAdapter from '../AdapterLoader';\n\nconst facebook = require('./facebook');\nconst facebookaccountkit = require('./facebookaccountkit');\nconst instagram = require(\"./instagram\");\nconst linkedin = require(\"./linkedin\");\nconst meetup = require(\"./meetup\");\nconst google = require(\"./google\");\nconst github = require(\"./github\");\nconst twitter = require(\"./twitter\");\nconst spotify = require(\"./spotify\");\nconst digits = require(\"./twitter\"); // digits tokens are validated by twitter\nconst janrainengage = require(\"./janrainengage\");\nconst janraincapture = require(\"./janraincapture\");\nconst vkontakte = require(\"./vkontakte\");\nconst qq = require(\"./qq\");\nconst wechat = require(\"./wechat\");\nconst weibo = require(\"./weibo\");\n\nconst anonymous = {\n  validateAuthData: () => {\n    return Promise.resolve();\n  },\n  validateAppId: () => {\n    return Promise.resolve();\n  }\n}\n\nconst providers = {\n  facebook,\n  facebookaccountkit,\n  instagram,\n  linkedin,\n  meetup,\n  google,\n  github,\n  twitter,\n  spotify,\n  anonymous,\n  digits,\n  janrainengage,\n  janraincapture,\n  vkontakte,\n  qq,\n  wechat,\n  weibo\n}\nfunction authDataValidator(adapter, appIds, options) {\n  return function(authData) {\n    return adapter.validateAuthData(authData, options).then(() => {\n      if (appIds) {\n        return adapter.validateAppId(appIds, authData, options);\n      }\n      return Promise.resolve();\n    });\n  }\n}\n\nfunction loadAuthAdapter(provider, authOptions) {\n  const defaultAdapter = providers[provider];\n  const adapter = Object.assign({}, defaultAdapter);\n  const providerOptions = authOptions[provider];\n\n  if (!defaultAdapter && !providerOptions) {\n    return;\n  }\n\n  const appIds = providerOptions ? providerOptions.appIds : undefined;\n\n  // Try the configuration methods\n  if (providerOptions) {\n    const optionalAdapter = loadAdapter(providerOptions, undefined, providerOptions);\n    if (optionalAdapter) {\n      ['validateAuthData', 'validateAppId'].forEach((key) => {\n        if (optionalAdapter[key]) {\n          adapter[key] = optionalAdapter[key];\n        }\n      });\n    }\n  }\n\n  if (!adapter.validateAuthData || !adapter.validateAppId) {\n    return;\n  }\n\n  return {adapter, appIds, providerOptions};\n}\n\nmodule.exports = function(authOptions = {}, enableAnonymousUsers = true) {\n  let _enableAnonymousUsers = enableAnonymousUsers;\n  const setEnableAnonymousUsers = function(enable) {\n    _enableAnonymousUsers = enable;\n  }\n  // To handle the test cases on configuration\n  const getValidatorForProvider = function(provider) {\n\n    if (provider === 'anonymous' && !_enableAnonymousUsers) {\n      return;\n    }\n\n    const {\n      adapter,\n      appIds,\n      providerOptions\n    } = loadAuthAdapter(provider, authOptions);\n\n    return authDataValidator(adapter, appIds, providerOptions);\n  }\n\n  return Object.freeze({\n    getValidatorForProvider,\n    setEnableAnonymousUsers\n  })\n}\n\nmodule.exports.loadAuthAdapter = loadAuthAdapter;\n"]}