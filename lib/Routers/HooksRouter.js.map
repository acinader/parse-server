{"version":3,"sources":["../../src/Routers/HooksRouter.js"],"names":["middleware","HooksRouter","PromiseRouter","createHook","aHook","config","hooksController","then","hook","response","updateHook","handlePost","req","body","handleGetFunctions","params","functionName","getFunction","foundFunction","Parse","Error","Promise","resolve","getFunctions","functions","err","handleGetTriggers","className","triggerName","getTrigger","foundTrigger","getTriggers","triggers","handleDelete","deleteFunction","deleteTrigger","handleUpdate","url","handlePut","__op","mountRoutes","route","promiseEnforceMasterKeyAccess","bind"],"mappings":"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","file":"HooksRouter.js","sourcesContent":["import { Parse }       from 'parse/node';\nimport PromiseRouter   from '../PromiseRouter';\nimport * as middleware from \"../middlewares\";\n\nexport class HooksRouter extends PromiseRouter {\n  createHook(aHook, config) {\n    return config.hooksController.createHook(aHook).then((hook) => ({response: hook}));\n  }\n\n  updateHook(aHook, config) {\n    return  config.hooksController.updateHook(aHook).then((hook) => ({response: hook}));\n  }\n\n  handlePost(req) {\n    return this.createHook(req.body, req.config);\n  }\n\n  handleGetFunctions(req) {\n    var hooksController = req.config.hooksController;\n    if (req.params.functionName) {\n      return hooksController.getFunction(req.params.functionName).then((foundFunction) => {\n        if (!foundFunction) {\n          throw new Parse.Error(143, `no function named: ${req.params.functionName} is defined`);\n        }\n        return Promise.resolve({response: foundFunction});\n      });\n    }\n\n    return hooksController.getFunctions().then((functions) => {\n      return { response: functions || [] };\n    }, (err) => {\n      throw err;\n    });\n  }\n\n  handleGetTriggers(req) {\n    var hooksController = req.config.hooksController;\n    if (req.params.className && req.params.triggerName) {\n\n      return hooksController.getTrigger(req.params.className, req.params.triggerName).then((foundTrigger) => {\n        if (!foundTrigger) {\n          throw new Parse.Error(143,`class ${req.params.className} does not exist`);\n        }\n        return Promise.resolve({response: foundTrigger});\n      });\n    }\n\n    return hooksController.getTriggers().then((triggers) => ({ response: triggers || [] }));\n  }\n\n  handleDelete(req) {\n    var hooksController = req.config.hooksController;\n    if (req.params.functionName) {\n      return hooksController.deleteFunction(req.params.functionName).then(() => ({response: {}}))\n\n    } else if (req.params.className && req.params.triggerName) {\n      return hooksController.deleteTrigger(req.params.className, req.params.triggerName).then(() => ({response: {}}))\n    }\n    return Promise.resolve({response: {}});\n  }\n\n  handleUpdate(req) {\n    var hook;\n    if (req.params.functionName && req.body.url) {\n      hook = {}\n      hook.functionName = req.params.functionName;\n      hook.url = req.body.url;\n    } else if (req.params.className && req.params.triggerName && req.body.url) {\n      hook = {}\n      hook.className = req.params.className;\n      hook.triggerName = req.params.triggerName;\n      hook.url = req.body.url\n    } else {\n      throw new Parse.Error(143, \"invalid hook declaration\");\n    }\n    return this.updateHook(hook, req.config);\n  }\n\n  handlePut(req) {\n    var body = req.body;\n    if (body.__op == \"Delete\") {\n      return this.handleDelete(req);\n    } else {\n      return this.handleUpdate(req);\n    }\n  }\n\n  mountRoutes() {\n    this.route('GET',  '/hooks/functions', middleware.promiseEnforceMasterKeyAccess, this.handleGetFunctions.bind(this));\n    this.route('GET',  '/hooks/triggers', middleware.promiseEnforceMasterKeyAccess, this.handleGetTriggers.bind(this));\n    this.route('GET',  '/hooks/functions/:functionName', middleware.promiseEnforceMasterKeyAccess, this.handleGetFunctions.bind(this));\n    this.route('GET',  '/hooks/triggers/:className/:triggerName', middleware.promiseEnforceMasterKeyAccess, this.handleGetTriggers.bind(this));\n    this.route('POST', '/hooks/functions', middleware.promiseEnforceMasterKeyAccess, this.handlePost.bind(this));\n    this.route('POST', '/hooks/triggers', middleware.promiseEnforceMasterKeyAccess, this.handlePost.bind(this));\n    this.route('PUT',  '/hooks/functions/:functionName', middleware.promiseEnforceMasterKeyAccess, this.handlePut.bind(this));\n    this.route('PUT',  '/hooks/triggers/:className/:triggerName', middleware.promiseEnforceMasterKeyAccess, this.handlePut.bind(this));\n  }\n}\n\nexport default HooksRouter;\n"]}