{"version":3,"sources":["../../src/Controllers/CacheController.js"],"names":["KEY_SEPARATOR_CHAR","joinKeys","keys","join","SubCache","constructor","prefix","cacheController","ttl","cache","get","key","cacheKey","put","value","del","clear","CacheController","AdaptableController","adapter","appId","options","role","user","then","Promise","resolve","expectedAdapterType","CacheAdapter"],"mappings":";;;;;;;AAAA;;;;AACA;;;;;;AAEA,MAAMA,qBAAqB,GAA3B;;AAEA,SAASC,QAAT,CAAkB,GAAGC,IAArB,EAA2B;AACzB,SAAOA,KAAKC,IAAL,CAAUH,kBAAV,CAAP;AACD;;AAED;;;;;AAKO,MAAMI,QAAN,CAAe;AACpBC,cAAYC,MAAZ,EAAoBC,eAApB,EAAqCC,GAArC,EAA0C;AACxC,SAAKF,MAAL,GAAcA,MAAd;AACA,SAAKG,KAAL,GAAaF,eAAb;AACA,SAAKC,GAAL,GAAWA,GAAX;AACD;;AAEDE,MAAIC,GAAJ,EAAS;AACP,UAAMC,WAAWX,SAAS,KAAKK,MAAd,EAAsBK,GAAtB,CAAjB;AACA,WAAO,KAAKF,KAAL,CAAWC,GAAX,CAAeE,QAAf,CAAP;AACD;;AAEDC,MAAIF,GAAJ,EAASG,KAAT,EAAgBN,GAAhB,EAAqB;AACnB,UAAMI,WAAWX,SAAS,KAAKK,MAAd,EAAsBK,GAAtB,CAAjB;AACA,WAAO,KAAKF,KAAL,CAAWI,GAAX,CAAeD,QAAf,EAAyBE,KAAzB,EAAgCN,GAAhC,CAAP;AACD;;AAEDO,MAAIJ,GAAJ,EAAS;AACP,UAAMC,WAAWX,SAAS,KAAKK,MAAd,EAAsBK,GAAtB,CAAjB;AACA,WAAO,KAAKF,KAAL,CAAWM,GAAX,CAAeH,QAAf,CAAP;AACD;;AAEDI,UAAQ;AACN,WAAO,KAAKP,KAAL,CAAWO,KAAX,EAAP;AACD;AAxBmB;;QAATZ,Q,GAAAA,Q;AA4BN,MAAMa,eAAN,SAA8BC,6BAA9B,CAAkD;;AAEvDb,cAAYc,OAAZ,EAAqBC,KAArB,EAA4BC,UAAU,EAAtC,EAA0C;AACxC,UAAMF,OAAN,EAAeC,KAAf,EAAsBC,OAAtB;;AAEA,SAAKC,IAAL,GAAY,IAAIlB,QAAJ,CAAa,MAAb,EAAqB,IAArB,CAAZ;AACA,SAAKmB,IAAL,GAAY,IAAInB,QAAJ,CAAa,MAAb,EAAqB,IAArB,CAAZ;AACD;;AAEDM,MAAIC,GAAJ,EAAS;AACP,UAAMC,WAAWX,SAAS,KAAKmB,KAAd,EAAqBT,GAArB,CAAjB;AACA,WAAO,KAAKQ,OAAL,CAAaT,GAAb,CAAiBE,QAAjB,EAA2BY,IAA3B,CAAgC,IAAhC,EAAsC,MAAMC,QAAQC,OAAR,CAAgB,IAAhB,CAA5C,CAAP;AACD;;AAEDb,MAAIF,GAAJ,EAASG,KAAT,EAAgBN,GAAhB,EAAqB;AACnB,UAAMI,WAAWX,SAAS,KAAKmB,KAAd,EAAqBT,GAArB,CAAjB;AACA,WAAO,KAAKQ,OAAL,CAAaN,GAAb,CAAiBD,QAAjB,EAA2BE,KAA3B,EAAkCN,GAAlC,CAAP;AACD;;AAEDO,MAAIJ,GAAJ,EAAS;AACP,UAAMC,WAAWX,SAAS,KAAKmB,KAAd,EAAqBT,GAArB,CAAjB;AACA,WAAO,KAAKQ,OAAL,CAAaJ,GAAb,CAAiBH,QAAjB,CAAP;AACD;;AAEDI,UAAQ;AACN,WAAO,KAAKG,OAAL,CAAaH,KAAb,EAAP;AACD;;AAEDW,wBAAsB;AACpB,WAAOC,sBAAP;AACD;AA9BsD;;QAA5CX,e,GAAAA,e;kBAiCEA,e","file":"CacheController.js","sourcesContent":["import AdaptableController from './AdaptableController';\nimport CacheAdapter        from '../Adapters/Cache/CacheAdapter';\n\nconst KEY_SEPARATOR_CHAR = ':';\n\nfunction joinKeys(...keys) {\n  return keys.join(KEY_SEPARATOR_CHAR);\n}\n\n/**\n * Prefix all calls to the cache via a prefix string, useful when grouping Cache by object type.\n *\n * eg \"Role\" or \"Session\"\n */\nexport class SubCache {\n  constructor(prefix, cacheController, ttl) {\n    this.prefix = prefix;\n    this.cache = cacheController;\n    this.ttl = ttl;\n  }\n\n  get(key) {\n    const cacheKey = joinKeys(this.prefix, key);\n    return this.cache.get(cacheKey);\n  }\n\n  put(key, value, ttl) {\n    const cacheKey = joinKeys(this.prefix, key);\n    return this.cache.put(cacheKey, value, ttl);\n  }\n\n  del(key) {\n    const cacheKey = joinKeys(this.prefix, key);\n    return this.cache.del(cacheKey);\n  }\n\n  clear() {\n    return this.cache.clear();\n  }\n}\n\n\nexport class CacheController extends AdaptableController {\n\n  constructor(adapter, appId, options = {}) {\n    super(adapter, appId, options);\n\n    this.role = new SubCache('role', this);\n    this.user = new SubCache('user', this);\n  }\n\n  get(key) {\n    const cacheKey = joinKeys(this.appId, key);\n    return this.adapter.get(cacheKey).then(null, () => Promise.resolve(null));\n  }\n\n  put(key, value, ttl) {\n    const cacheKey = joinKeys(this.appId, key);\n    return this.adapter.put(cacheKey, value, ttl);\n  }\n\n  del(key) {\n    const cacheKey = joinKeys(this.appId, key);\n    return this.adapter.del(cacheKey);\n  }\n\n  clear() {\n    return this.adapter.clear();\n  }\n\n  expectedAdapterType() {\n    return CacheAdapter;\n  }\n}\n\nexport default CacheController;\n"]}